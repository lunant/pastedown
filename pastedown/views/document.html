{% extends "base.html" %}
{% block title -%}
  {{ document.title|escape }} &mdash; Pastedown
{%- endblock %}
{% block body_class -%}
  document
{%- endblock %}
{% block body %}
  <article>{{ revision.html }}</article>
  <aside>
    {% if document.parent_document %}
      <p>It forks <a href="{{ document.parent_document|url|escape }}">
         {{ document.parent_revision.title }}</a>.</p>
    {% endif %}
    {% if document.forks.count(1) %}
      <ul class="forks">
        {% for fork in document.forks %}
          <li><a href="{{ fork|url|escape }}">{{ fork.title }}</a></li>
        {% endfor %}
      </ul>
    {% endif %}
    {% if document.revisions.count(2) > 1 %}
      <ul class="history">
        {% for rev in document.revisions: %}
          <li><a href="{{ rev|url|escape }}">{{ rev.created_at }}</a>
              by <a href="{{ rev.author|url|escape }}">
              {{ rev.author.nick|escape }}</a></li>
        {% endfor %}
      </ul>
    {% endif %}
    {% if document.is_modifiable(person) %}
      <form method="put" action="{{ document|url|escape }}" class="update">
        <fieldset>
          <legend>Update the document</legend>
          <textarea name="body" rows="10" cols="80">
            {{- revision.body|escape -}}
          </textarea>
          <button type="submit">Update</button>
        </fieldset>
      </form>
      <form method="delete" action="{{ document|url|escape }}" class="delete">
        <fieldset>
          <legend>Delete the document</legend>
          <button type="submit">Delete</button>
        </fieldset>
      </form>
    {% endif %}
    <form method="post" action="" class="fork">
      <fieldset>
        <legend>Fork the document</legend>
        <textarea name="body" rows="10" cols="80">
          {{- revision.body|escape -}}
        </textarea>
        <button type="submit">Fork</button>
      </fieldset>
    </form>
  </aside>
  <footer>
    <div class="powered-by">
      <h1><a href="/">Pastedown</a></h1>
      <p>The pastebin service for
         <a href="http://daringfireball.net/projects/markdown/">Markdown</a>
         documents.</p>
    </div>
    <p class="copyright">
      Copyright &copy; 2010 <a href="http://lunant.net/">Lunant</a>.
      <a href="http://bitbucket.org/lunant/pastedown/">
        The source code is available</a> under
      <a href="http://www.gnu.org/licenses/agpl-3.0.html">AGPL</a>.
    </p>
  </footer>
{% endblock %}
